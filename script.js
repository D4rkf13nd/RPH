const quizData = [
    {
        question: "What is history primarily defined as?",
        options: [
            "A collection of stories",
            "An academic discipline and systematic study of the past",
            "A series of dates and events",
            "A record of wars and conflicts"
        ],
        correct: 1
    },
    {
        question: "What does the systematic study of history involve?",
        options: [
            "Only memorizing dates and events",
            "Only studying ancient civilizations",
            "Analyzing sources, interpreting evidence, and constructing narratives",
            "Only reading historical documents"
        ],
        correct: 2
    },
    {
        question: "According to Robert Heinlein, what happens to a generation that ignores history?",
        options: [
            "They become more progressive",
            "They have no past and no future",
            "They become more innovative",
            "They develop better technology"
        ],
        correct: 1
    },
    {
        question: "What are the three systematic processes in studying history?",
        options: [
            "Read, Write, Research",
            "Study, Learn, Memorize",
            "Analyze, Interpret, Construct",
            "Document, Record, Archive"
        ],
        correct: 2
    },
    {
        question: "What is Historiography?",
        options: [
            "The study of historical artifacts",
            "The study of how history has been written and understood over time",
            "The study of historical figures",
            "The study of historical dates"
        ],
        correct: 1
    },
    {
        question: "Which is NOT one of the five categories of Primary Sources?",
        options: [
            "Written documents",
            "Numerical records",
            "Secondary interpretations",
            "Relics"
        ],
        correct: 2
    },
    {
        question: "What is the Primary Goal of Historical Criticism?",
        options: [
            "To create new historical theories",
            "To discover the text's primitive or original historical context",
            "To compare different historical accounts",
            "To analyze modern interpretations"
        ],
        correct: 1
    },
    {
        question: "What are the two types of Historical Criticism?",
        options: [
            "Internal and External Criticism",
            "Primary and Secondary Criticism",
            "Formal and Informal Criticism",
            "Direct and Indirect Criticism"
        ],
        correct: 0
    },
    {
        question: "What is the correct process in Conducting Content Analysis?",
        options: [
            "Identify themes, examine word choice, look for facts vs opinions, analyze imagery",
            "Read the text, summarize, conclude, report",
            "Collect data, analyze data, interpret data, present findings",
            "Research background, collect sources, analyze content, write conclusions"
        ],
        correct: 0
    },
    {
        question: "Which of the following is NOT one of the three concepts of history?",
        options: [
            "Based on past events",
            "Interpreted by someone, usually historians",
            "Based on future predictions",
            "Rely on data and documents called historical sources"
        ],
        correct: 2
    },
    {
        question: "In historical methodology, what are primary sources?",
        options: [
            "Scholarly works that analyze historical events",
            "Documents created during modern times",
            "Firsthand records created during the time being studied",
            "Summarized compilations of historical data"
        ],
        correct: 2
    },
    {
        question: "What is a cartographer?",
        options: [
            "A person who studies maps",
            "A person who draws or creates maps",
            "A person who collects historical artifacts",
            "A person who writes historical documents"
        ],
        correct: 1
    },
    {
        question: "What is the primary goal of historical criticism?",
        options: [
            "To discover modern interpretations of text",
            "To discover the text's primitive or original historical context",
            "To create new historical theories",
            "To compare different historical accounts"
        ],
        correct: 1
    },
    {
        question: "Which of the following is NOT one of the 5 categories of primary sources?",
        options: [
            "Written documents",
            "Numerical records",
            "Secondary interpretations",
            "Oral statements"
        ],
        correct: 2
    },
    {
        question: "Who was Antonio Pigafetta?",
        options: [
            "A Spanish conquistador",
            "A Filipino historian",
            "An Italian scholar and one of Magellan's chroniclers",
            "A Portuguese explorer"
        ],
        correct: 2
    },
    {
        question: "According to Pigafetta's account, when was the first Mass in the Philippines celebrated?",
        options: [
            "March 31, 1521",
            "April 1, 1521",
            "March 30, 1521",
            "April 15, 1521"
        ],
        correct: 0
    },
    {
        question: "What was 'La Verdad'?",
        options: [
            "A Spanish newspaper",
            "A newspaper published by Father Gomez before his execution",
            "A government document",
            "A revolutionary manifesto"
        ],
        correct: 1
    },
    {
        question: "What was the significance of the Cry of Balintawak/Pugadlawin?",
        options: [
            "The establishment of the Katipunan",
            "The tearing of cedulas",
            "The declaration of war against America",
            "The signing of independence"
        ],
        correct: 1
    },
    {
        question: "Who painted 'The Parisian Life'?",
        options: [
            "Jose Rizal",
            "Juan Luna",
            "Antonio Luna",
            "Fernando Amorsolo"
        ],
        correct: 1
    },
    {
        question: "What were the three interpretations of 'The Parisian Life'?",
        options: [
            "Historical, Religious, Political",
            "Kwentong Barbero, Biographical and Tragic, Symbolic",
            "Classical, Historical, Modern",
            "Romantic, Tragic, Symbolic"
        ],
        correct: 1
    },
    {
        question: "Where was the Proclamation of Philippine Independence declared?",
        options: [
            "Manila",
            "Kawit, Cavite",
            "Malolos, Bulacan",
            "Balintawak, Quezon City"
        ],
        correct: 1
    },
    {
        question: "During the Proclamation of Independence, what two important national symbols were first presented?",
        options: [
            "The Philippine flag and National ID",
            "The Philippine flag and Lupang Hinirang",
            "The National Seal and Lupang Hinirang",
            "The National Anthem and National Seal"
        ],
        correct: 1
    },
    {
        question: "What was Corazon Aquino's memorable line in her speech to the U.S. Congress?",
        options: [
            "Democracy is our strength",
            "The Philippines shall rise again",
            "I have not come here to beg for help. I have come to ask for justice",
            "Freedom is our birthright"
        ],
        correct: 2
    },
    {
        question: "What evidence supported Limasawa as the site of the First Mass according to the commission's findings?",
        options: [
            "The testimony of local residents",
            "Archaeological findings in the area",
            "Pigafetta's account and matching geographical coordinates",
            "Spanish colonial records"
        ],
        correct: 2
    },
    {
        question: "Who were the GOMBURZA?",
        options: [
            "Revolutionary leaders of the Katipunan",
            "Spanish governors in the Philippines",
            "Three martyr priests: Fathers Mariano Gomez, Jose Burgos, and Jacinto Zamora",
            "Filipino military commanders"
        ],
        correct: 2
    },
    {
        question: "What were the three interpretations of Juan Luna's 'The Parisian Life'?",
        options: [
            "Historical, Religious, Political",
            "Kwentong Barbero, Biographical and Tragic, Symbolic",
            "Romantic, Classical, Modern",
            "Social, Cultural, Political"
        ],
        correct: 1
    },
    {
        question: "What was the significance of Corazon Aquino's speech to the U.S. Congress?",
        options: [
            "It led to the fall of the Marcos regime",
            "It resulted in $200 million in aid and restored international credibility",
            "It established martial law in the Philippines",
            "It broke diplomatic ties with the United States"
        ],
        correct: 1
    },
    {
        question: "What happened during the Proclamation of Philippine Independence?",
        options: [
            "Only the flag was raised",
            "Only the national anthem was played",
            "Both the Philippine flag was unfurled and Lupang Hinirang was first played",
            "Neither the flag nor anthem were presented"
        ],
        correct: 2
    },
    {
        question: "What aspects of past events does history examine?",
        options: [
            "Only political developments",
            "Only economic developments",
            "Political, economic, social, and cultural developments",
            "Only military developments"
        ],
        correct: 2
    },
    {
        question: "What are secondary sources in history?",
        options: [
            "Original documents from the time period",
            "Interpretations and analysis written by historians",
            "Physical artifacts",
            "Oral traditions"
        ],
        correct: 1
    },
    {
        question: "What is one of the key aspects of interpretation and analysis in history?",
        options: [
            "Only focusing on facts",
            "Ignoring different perspectives",
            "Understanding perspectives, motivations, and contexts",
            "Accepting only one interpretation"
        ],
        correct: 2
    },
    {
        question: "Which approach is used in historical methodology?",
        options: [
            "Single-discipline approach only",
            "Cross-disciplinary approach incorporating multiple fields",
            "Political science only",
            "Archaeology only"
        ],
        correct: 1
    },
    {
        question: "What is comparative history?",
        options: [
            "Studying only one culture",
            "Examining similarities and differences across cultures or periods",
            "Focusing only on modern history",
            "Analyzing only ancient history"
        ],
        correct: 1
    },
    {
        question: "What is one key benefit of studying history?",
        options: [
            "Learning only about wars",
            "Memorizing dates",
            "Develops critical thinking and analytical skills",
            "Studying only ancient civilizations"
        ],
        correct: 2
    },
    {
        question: "What is a tertiary source in history?",
        options: [
            "Original documents",
            "Eyewitness accounts",
            "Compiled and summarized sources",
            "Archaeological artifacts"
        ],
        correct: 2
    },
    {
        question: "What does external criticism in historical analysis investigate?",
        options: [
            "The content of the document",
            "The document's form and origin",
            "The author's opinions",
            "The historical context"
        ],
        correct: 1
    },
    {
        question: "What is anachronism in historical context?",
        options: [
            "A correct chronological order",
            "Something out of time or order",
            "A historical date",
            "A timeline of events"
        ],
        correct: 1
    },
    {
        question: "What should be examined in word choice analysis during content analysis?",
        options: [
            "Only grammar",
            "Only spelling",
            "Whether it's formal, emotional, persuasive, or neutral",
            "Only punctuation"
        ],
        correct: 2
    },
    {
        question: "Who was Francisco Albo?",
        options: [
            "A Spanish governor",
            "A Filipino revolutionary",
            "A pilot in Magellan's fleet",
            "A church official"
        ],
        correct: 2
    },
    {
        question: "What was the age of Father Jose Burgos when he was martyred?",
        options: [
            "72 years old",
            "35 years old",
            "36 years old",
            "40 years old"
        ],
        correct: 1
    },
    {
        question: "What was 'polo y servicios'?",
        options: [
            "A Spanish festival",
            "A type of government",
            "Forced labor and taxes imposed on Filipinos",
            "A religious ceremony"
        ],
        correct: 2
    },
    {
        question: "Who was Gregoria de Jesus?",
        options: [
            "A Spanish nun",
            "Mother of Katipunan and wife of Andres Bonifacio",
            "A revolutionary soldier",
            "A government official"
        ],
        correct: 1
    },
    {
        question: "Where is the Balintawak Monument located?",
        options: [
            "Manila",
            "Cavite",
            "Northern part of Quezon City near EDSA and Caloocan",
            "Makati"
        ],
        correct: 2
    },
    {
        question: "When was Juan Luna born?",
        options: [
            "October 24, 1857",
            "December 7, 1899",
            "January 1, 1857",
            "October 24, 1858"
        ],
        correct: 0
    },
    {
        question: "What was the size of 'The Parisian Life' painting?",
        options: [
            "20x30 inches",
            "22x31 inches",
            "25x35 inches",
            "30x40 inches"
        ],
        correct: 1
    },
    {
        question: "What major achievement did Juan Luna receive for his Spoliarium?",
        options: [
            "Bronze medal",
            "Silver medal",
            "Gold medal from Madrid Exposition",
            "No medal"
        ],
        correct: 2
    },
    {
        question: "When did Corazon Aquino deliver her speech to the U.S. Congress?",
        options: [
            "September 18, 1986",
            "February 1986",
            "December 1986",
            "January 1987"
        ],
        correct: 0
    },
    {
        question: "Who wrote the Act of the Proclamation of Independence?",
        options: [
            "Emilio Aguinaldo",
            "Ambrosio Rianzares Bautista",
            "Andres Bonifacio",
            "Jose Rizal"
        ],
        correct: 1
    },
    {
        question: "What event weakened Spain's control in Asia by early 1898?",
        options: [
            "The Philippine Revolution",
            "The Spanish-American War",
            "The Katipunan Uprising",
            "The Manila Galleon Trade"
        ],
        correct: 1
    },
    {
        question: "Which school did Juan Luna attend for Marine Transportation?",
        options: [
            "University of Santo Tomas",
            "Ateneo de Municipal",
            "Escuela Nautica de Manila",
            "University of the Philippines"
        ],
        correct: 2
    },
    {
        question: "What is the name for someone who draws or creates maps?",
        options: [
            "Geographer",
            "Cartographer",
            "Topographer",
            "Mapper"
        ],
        correct: 1
    },
    {
        question: "What was the first name of the martyr priest Gomez?",
        options: [
            "Jose",
            "Jacinto",
            "Mariano",
            "Manuel"
        ],
        correct: 2
    },
    {
        question: "What document formally established the First Philippine Republic?",
        options: [
            "Treaty of Paris",
            "Malolos Constitution",
            "Pact of Biak-na-Bato",
            "Tejeros Convention"
        ],
        correct: 1
    },
    {
        question: "How many categories of Primary Sources are there?",
        options: [
            "3",
            "4",
            "5",
            "6"
        ],
        correct: 2
    }
];

let currentAnswers = new Array(quizData.length).fill(-1);
let currentQuestion = 0;

function createQuiz() {
    const quizContainer = document.getElementById('quiz');
    quizContainer.innerHTML = '';
    
    quizData.forEach((question, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question-container';
        if (index === 0) questionDiv.classList.add('active');
        
        // Build options; include feedback container for immediate response
        questionDiv.innerHTML = `
            <div class="question">${index + 1}. ${question.question}</div>
            <div class="options">
                ${question.options.map((option, optionIndex) => `
                    <div class="option" data-q="${index}" data-o="${optionIndex}" onclick="selectOption(${index}, ${optionIndex})">
                        ${String.fromCharCode(97 + optionIndex)}) ${option}
                    </div>
                `).join('')}
            </div>
            <div class="feedback" id="feedback-${index}" aria-live="polite"></div>
        `;
        
        quizContainer.appendChild(questionDiv);
    });
    // Restore any previous answers (when resetting or revisiting)
    quizData.forEach((_, index) => {
        if (currentAnswers[index] !== -1) {
            const qDiv = document.querySelectorAll('.question-container')[index];
            const options = qDiv.querySelectorAll('.option');
            const ans = currentAnswers[index];
            options.forEach(opt => opt.style.pointerEvents = 'none');
            options[ans].classList.add('selected');
            const correctIndex = quizData[index].correct;
            const feedbackEl = document.getElementById(`feedback-${index}`);
            if (ans === correctIndex) {
                options[ans].classList.add('correct');
                feedbackEl.textContent = 'Correct!';
                feedbackEl.style.color = '#2e7d32';
            } else {
                options[ans].classList.add('wrong');
                options[correctIndex].classList.add('correct');
                feedbackEl.textContent = `Incorrect. Correct answer: ${options[correctIndex].textContent}`;
                feedbackEl.style.color = '#c62828';
            }
        }
    });

    updateNavigation();
}

function selectOption(questionIndex, optionIndex) {
    // If already answered, ignore further clicks
    if (currentAnswers[questionIndex] !== -1) return;

    const questionContainer = document.querySelectorAll('.question-container')[questionIndex];
    const options = questionContainer.querySelectorAll('.option');

    // Mark selected
    options[optionIndex].classList.add('selected');
    currentAnswers[questionIndex] = optionIndex;

    // Disable all options for this question
    options.forEach(option => {
        option.style.pointerEvents = 'none';
    });

    // Show immediate feedback and highlight correct/wrong
    const correctIndex = quizData[questionIndex].correct;
    const feedbackEl = document.getElementById(`feedback-${questionIndex}`);
    if (optionIndex === correctIndex) {
        options[optionIndex].classList.add('correct');
        feedbackEl.textContent = 'Correct!';
        feedbackEl.style.color = '#2e7d32';
    } else {
        options[optionIndex].classList.add('wrong');
        options[correctIndex].classList.add('correct');
        const correctText = questionContainer.querySelectorAll('.option')[correctIndex].textContent;
        feedbackEl.textContent = `Incorrect. Correct answer: ${correctText}`;
        feedbackEl.style.color = '#c62828';
    }

    // Enable navigation (Next/Submit) since this question is answered
    updateNavigation();
}

function checkAnswers() {
    let score = 0;
    const questions = document.querySelectorAll('.question-container');
    
    questions.forEach((question, index) => {
        const options = question.querySelectorAll('.option');
        const selectedOption = currentAnswers[index];
        
        options.forEach(option => {
            option.style.pointerEvents = 'none';
        });
        
        if (selectedOption === quizData[index].correct) {
            score++;
            options[selectedOption].classList.add('correct');
        } else if (selectedOption !== -1) {
            options[selectedOption].classList.add('wrong');
            options[quizData[index].correct].classList.add('correct');
        }
    });
    
    const result = document.getElementById('result');
    const percentage = (score / quizData.length) * 100;
    result.style.display = 'block';
    result.style.backgroundColor = percentage >= 70 ? '#c8e6c9' : '#ffcdd2';
    result.innerHTML = `Your score: ${score}/${quizData.length} (${percentage.toFixed(2)}%)`;
    
    document.querySelector('.submit-btn').style.display = 'none';
    document.querySelector('.retry-btn').style.display = 'block';
}

function nextQuestion() {
    if (currentQuestion < quizData.length - 1) {
        const questions = document.querySelectorAll('.question-container');
        questions[currentQuestion].classList.remove('active');
        currentQuestion++;
        questions[currentQuestion].classList.add('active');
        updateNavigation();
    }
}

function previousQuestion() {
    if (currentQuestion > 0) {
        const questions = document.querySelectorAll('.question-container');
        questions[currentQuestion].classList.remove('active');
        currentQuestion--;
        questions[currentQuestion].classList.add('active');
        updateNavigation();
    }
}

function updateNavigation() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.querySelector('.submit-btn');
    const counter = document.getElementById('questionCounter');
    const progress = document.getElementById('progress');
    
    prevBtn.disabled = currentQuestion === 0;
    
    // Require answering current question before allowing Next/Submit
    const answered = currentAnswers[currentQuestion] !== -1;

    if (currentQuestion === quizData.length - 1) {
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'block';
        submitBtn.disabled = !answered;
    } else {
        nextBtn.style.display = 'block';
        nextBtn.disabled = !answered;
        submitBtn.style.display = 'none';
        submitBtn.disabled = true;
    }
    
    counter.textContent = `Question ${currentQuestion + 1} of ${quizData.length}`;
    progress.style.width = `${((currentQuestion + 1) / quizData.length) * 100}%`;
}

function resetQuiz() {
    currentAnswers = new Array(quizData.length).fill(-1);
    currentQuestion = 0;
    const quizContainer = document.getElementById('quiz');
    quizContainer.innerHTML = '';
    createQuiz();
    
    document.getElementById('result').style.display = 'none';
    document.querySelector('.submit-btn').style.display = 'none';
    document.querySelector('.retry-btn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'block';
    updateNavigation();
}

// Initialize the quiz when the page loads
window.onload = createQuiz;